#!/bin/sh

# Pre-commit hook: Run linting, type checking, and architecture validation
# This ensures code quality before commits reach the repository
# Uses 'just' if available, falls back to npm scripts

echo "ğŸ” Running pre-commit checks..."

# Check if 'just' is available
if command -v just > /dev/null 2>&1; then
    echo "ğŸ“‹ Using Just for pre-commit workflow..."
    just pre-commit
    exit $?
fi

# Fallback to npm scripts if 'just' is not installed
echo "ğŸ“‹ Using npm scripts for pre-commit workflow..."

# Run lint-staged (ESLint + Prettier on staged files)
echo "ğŸ“ Checking staged files with lint-staged..."
npx lint-staged
if [ $? -ne 0 ]; then
    echo "âŒ lint-staged failed. Please fix the issues above."
    exit 1
fi

# Run TypeScript type check
echo "ğŸ” Running TypeScript type check..."
npm run typecheck
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript type check failed. Please fix type errors."
    exit 1
fi

# Run architecture validation
echo "ğŸ—ï¸ Validating DDD architecture..."
npm run validate:layers
if [ $? -ne 0 ]; then
    echo "âŒ Architecture validation failed. Check layer dependencies."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
